<!DOCTYPE html>
<html lang="pt-BR">

    <head>
        <meta charset="UTF-8">
        <title>Pedido - Avanade E-commerce</title>
        <link rel="stylesheet" href="css/style.css">
    </head>

    <body>
        <nav class="topbar">
            <div class="topbar-content">
                <span>Painel Administrativo</span>
                <button onclick="sair()">SAIR</button>
            </div>
        </nav>

        <header>
            <div>
                <img src="/img/banner1.jpg" alt="Banner">
            </div>
        </header>

        <main>
            <div class="login-box">
                <h2>Criar Pedido</h2>
                <div id="produtos-container"></div>
                <button onclick="enviarPedido()">Enviar Pedido</button>
                <p id="mensagem" style="color: green;"></p>
            </div>
        </main>



        <footer>
            <div><img src="/img/logo_si.png" alt="Logotipo SI" width="40px" height="35px"></div><br>
            <div><small>&copy; 2025 SICOESQUE . All rights reserved </small>
                <div><small>&copy; Desenvolvido por <a href="https://wa.me/28999452754">Sol
                            Morcillo</a></small></div>
        </footer>

        <script>
            const token = localStorage.getItem('token');
            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            };

            async function carregarProdutos() {
                const res = await fetch('https://localhost:5179/api/produtos', { headers });
                const produtos = await res.json();
                const container = document.getElementById('produtos-container');
                container.innerHTML = '';

                produtos.forEach(produto => {
                    const div = document.createElement('div');
                    div.innerHTML = `
        <label>${produto.nome} (R$${produto.preco}) - Estoque: ${produto.quantidade}</label>
        <input type="number" min="0" id="produto-${produto.id}" placeholder="Quantidade">
      `;
                    container.appendChild(div);
                });
            }

            async function enviarPedido() {
                const res = await fetch('https://localhost:5179/api/produtos', { headers });
                const produtos = await res.json();
                const itens = [];

                produtos.forEach(produto => {
                    const qtd = parseInt(document.getElementById(`produto-${produto.id}`).value);
                    if (qtd > 0) {
                        itens.push({ produtoId: produto.id, quantidade: qtd });
                    }
                });

                if (itens.length === 0) {
                    document.getElementById('mensagem').textContent = 'Selecione ao menos um produto.';
                    document.getElementById('mensagem').style.color = 'red';
                    return;
                }

                const pedido = { itens };

                const response = await fetch('https://localhost:5176/api/pedidos', {
                    method: 'POST',
                    headers,
                    body: JSON.stringify(pedido)
                });

                if (response.ok) {
                    document.getElementById('mensagem').textContent = 'Pedido enviado com sucesso!';
                    document.getElementById('mensagem').style.color = 'green';
                } else {
                    document.getElementById('mensagem').textContent = 'Erro ao enviar pedido.';
                    document.getElementById('mensagem').style.color = 'red';
                }
            }

            carregarProdutos();
        </script>


        <script>
            function sair() {
                localStorage.removeItem('token');
                window.location.href = 'login.html';
            }
        </script>


    </body>

</html>